---
- name: Asegura que la maquina esté registrada
  community.general.redhat_subscription:
    state: present
    username: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          39333536336666343162646133623033353865663761356134366631653537343539363236613738
          3835663636313230386466643039643530316238373666350a623663663839353436316633663261
          62666337376430363866336135393635643034633938376639653538643939353565376531393338
          6137326130343736650a666637313465616264333834323535303336383966396562616662623930
          61363835353564316438306164393163313530333434393362343765386337636664

          
    password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          32396466343166363665386631363631613561326531373636346335386362666466316337643664
          3866326165663866303934313565363735306333353335330a396631383539316639323264323763
          30393365303537373038613337343261343833353734343266343930386562353036653031363335
          3262623937356534630a613963613065653133613730633361613466316439303933653838306535
          6264

  tags:
    - registration
    
- name: Registrar con Insights
  ansible.builtin.include_role:
    name: redhat.insights.insights_client
    apply:
      tags:
        - registration
  tags:
    - registration
    
- name: Asegura que la convención de nombre del equipo se cumpla
  ansible.builtin.fail:
  when: ansible_hostname is not regex('[-a-z\d]+')
...
